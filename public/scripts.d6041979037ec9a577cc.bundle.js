function Plot(e){function t(e){e||(e=window.event),e.preventDefault&&e.preventDefault(),e.returnValue=!1}this.delegateCanvas=e,this.resolution={x:e.width,y:e.height},this.halfResolution={x:e.width/2,y:e.height/2},this.origin={x:0,y:0},this.mouseWorld={x:-1,y:-1},this.mouseScreen={x:-1,y:-1},this.zoom=10,this.zoomInverse=1/this.zoom,this.backgroundColor="#FFFFFF",this.gridColor="#C8C8FF",this.axesColor="#000000",this.plots=[],this.mousehover=!1,this.screenToWorldCoordinates=function(e){var t=new Object;return t.x=(e.x-this.halfResolution.x)*this.zoomInverse+this.origin.x,t.y=-(e.y-this.halfResolution.y)*this.zoomInverse+this.origin.y,t},this.worldToScreenCoordinates=function(e){var t=new Object;return t.x=(e.x-this.origin.x)*this.zoom+this.halfResolution.x,t.y=-(e.y-this.origin.y)*this.zoom+this.halfResolution.y,t},this.clear=function(e){e.fillStyle=this.backgroundColor,e.fillRect(0,0,this.resolution.x,this.resolution.y)},this.drawAxes=function(e){var t={x:0,y:0},o={x:this.resolution.x,y:this.resolution.y};if(t=this.screenToWorldCoordinates(t),o=this.screenToWorldCoordinates(o),t.x<=0&&o.x>=0){var i={x:0,y:t.y},n={x:0,y:o.y};i=this.worldToScreenCoordinates(i),n=this.worldToScreenCoordinates(n),e.strokeStyle=this.axesColor,e.beginPath(),e.moveTo(i.x,i.y),e.lineTo(n.x,n.y),e.stroke()}if(t.y>=0&&o.y<=0){var s={x:t.x,y:0},r={x:o.x,y:0};s=this.worldToScreenCoordinates(s),r=this.worldToScreenCoordinates(r),e.strokeStyle=this.axesColor,e.beginPath(),e.moveTo(s.x,s.y),e.lineTo(r.x,r.y),e.stroke()}},this.drawGrid=function(e){var t={x:0,y:0},o={x:this.resolution.x,y:this.resolution.y};t=this.screenToWorldCoordinates(t),o=this.screenToWorldCoordinates(o);var i=o.x-t.x,n=t.y-o.y,s=Math.floor(Math.log10(i)),r=Math.floor(Math.log10(n));if(s<r){var a=s,l=Math.pow(10,a-1),h=Math.pow(10,a),d=Math.floor(i/l);Math.floor(i/h)}else{var a=r,l=Math.pow(10,a-1),h=Math.pow(10,a),d=Math.floor(n/l);Math.floor(n/h)}e.strokeStyle=this.gridColor,e.globalAlpha=1-d/99;for(var u=Math.floor(t.x/l)*l,c=new Object,y=new Object;u<o.x;)c.x=u,c.y=t.y,y.x=u,y.y=o.y,c=this.worldToScreenCoordinates(c),y=this.worldToScreenCoordinates(y),e.beginPath(),e.moveTo(c.x,c.y),e.lineTo(y.x,y.y),e.stroke(),u+=l;for(var m=Math.floor(o.y/l)*l,x=new Object,p=new Object;m<t.y;)x.x=t.x,x.y=m,p.x=o.x,p.y=m,x=this.worldToScreenCoordinates(x),p=this.worldToScreenCoordinates(p),e.beginPath(),e.moveTo(x.x,x.y),e.lineTo(p.x,p.y),e.stroke(),m+=l;e.globalAlpha=1;for(var u=Math.floor(t.x/h)*h,c=new Object,y=new Object;u<o.x;)c.x=u,c.y=t.y,y.x=u,y.y=o.y,c=this.worldToScreenCoordinates(c),y=this.worldToScreenCoordinates(y),e.beginPath(),e.moveTo(c.x,c.y),e.lineTo(y.x,y.y),e.stroke(),u+=h;for(var m=Math.floor(o.y/h)*h,x=new Object,p=new Object;m<t.y;)x.x=t.x,x.y=m,p.x=o.x,p.y=m,x=this.worldToScreenCoordinates(x),p=this.worldToScreenCoordinates(p),e.beginPath(),e.moveTo(x.x,x.y),e.lineTo(p.x,p.y),e.stroke(),m+=h},this.defaultResizeListener=function(){this.delegateCanvas.width=this.delegateCanvas.clientWidth,this.delegateCanvas.height=this.delegateCanvas.clientHeight,this.resolution.x=this.delegateCanvas.width,this.resolution.y=this.delegateCanvas.height,this.halfResolution.x=this.delegateCanvas.width/2,this.halfResolution.y=this.delegateCanvas.height/2,this.render()},this.defaultMouseMoveListener=function(e){var t=this.delegateCanvas.getBoundingClientRect();this.mouseScreen={x:e.clientX-t.left,y:e.clientY-t.top},this.mouseWorld=this.screenToWorldCoordinates(this.mouseScreen)},this.defaultMouseWheelListener=function(e){e.deltaY<0?(this.zoom=1.05*this.zoom,this.zoomInverse=1/this.zoom):(this.zoom=.95*this.zoom,this.zoomInverse=1/this.zoom),this.render()},this.defaultMouseClickListener=function(e){var t=this.delegateCanvas.getBoundingClientRect();this.mouseScreen={x:e.clientX-t.left,y:e.clientY-t.top},this.mouseWorld=this.screenToWorldCoordinates(this.mouseScreen),this.origin.x=this.mouseWorld.x,this.origin.y=this.mouseWorld.y,this.mouseScreen={x:this.halfResolution.x,y:this.halfResolution.y},this.mouseWorld={x:0,y:0},this.render()},this.defaultMouseOverListener=function(){document.onmousewheel=function(){t()},document.addEventListener&&document.addEventListener("DOMMouseScroll",t,!1)},this.defaultMouseOutListener=function(){document.onmousewheel=null,document.addEventListener&&document.removeEventListener("DOMMouseScroll",t,!1),console.log("mouseleft")},this.render=function(){var e=this.delegateCanvas.getContext("2d");this.clear(e),this.drawGrid(e),this.drawAxes(e);for(var t=null,o=null,i=0;i<this.plots.length;i++){e.strokeStyle=this.plots[i].color,e.beginPath(),t=this.screenToWorldCoordinates({x:0,y:0}),t.y=parseFloat(this.plots[i].function.eval({x:t.x})),o=this.worldToScreenCoordinates(t),e.moveTo(o.x,o.y);for(var n=1;n<this.delegateCanvas.clientWidth;n++)t=this.screenToWorldCoordinates({x:n,y:0}),t.y=parseFloat(this.plots[i].function.eval({x:t.x})),o=this.worldToScreenCoordinates(t),e.lineTo(o.x,o.y);e.stroke()}}}function mathtalkInit(){MathJax.Hub.Config({tex2jax:{inlineMath:[["$","$"],["\\(","\\)"]]}}),$(document).on("DOMNodeInserted",function(e){e.target.lastElementChild&&("mathtalk-preview-output"==e.target.lastElementChild.id?$("#mathtalk-preview-input").on("change keyup paste",function(e){document.getElementById("mathtalk-preview-output").innerHTML="",document.getElementById("mathtalk-preview-output").appendChild(mathtalkRender(document.getElementById("mathtalk-preview-input").value)),MathJax.Hub.Queue(["Typeset",MathJax.Hub],document.getElementById("mathtalk-preview-output"))}):"mathtalk-reply-preview-output"==e.target.lastElementChild.id&&$("#mathtalk-reply-preview-input").on("change keyup paste",function(e){document.getElementById("mathtalk-reply-preview-output").innerHTML="",document.getElementById("mathtalk-reply-preview-output").appendChild(mathtalkRender(document.getElementById("mathtalk-reply-preview-input").value)),MathJax.Hub.Queue(["Typeset",MathJax.Hub],document.getElementById("mathtalk-reply-preview-output"))})),document.getElementById("mathtalk-post-body")&&($("#mathtalk-post-body").hasClass("mathtalk-finished-rendering")||($("#mathtalk-post-body").addClass("mathtalk-finished-rendering"),setTimeout(function(){MathJax.Hub.Queue(["Typeset",MathJax.Hub],document.getElementById("mathtalk-post-body"))},500)))})}function mathtalkRender(e){var t=e.match(/\\plot\[[^\]]*\]/g);if(t){for(var o=0;o<t.length;o++)t[o]=t[o].substring(5).replace(/\n/g,"");try{t=JSON.parse(t)}catch(e){console.log("could not parse")}}e=e.split(/\\plot\[[^\]]*\]/g);for(var i,n,s=document.createElement("div"),o=0;o<e.length;o++){var r=document.createElement("p");r.textContent=e[o],s.appendChild(r),t&&t[o]&&(i=document.createElement("div"),i.id="mathtalkPlot"+Date.now().toString()+o.toString(),i.style="width: 200px; height: 200px;",plotCanvas=document.createElement("canvas"),i.appendChild(plotCanvas),s.appendChild(i),n=new Plot(plotCanvas),n.plots.push({function:math.compile("3*x+1"),color:"black"}),n.render())}return s}var targets=[];